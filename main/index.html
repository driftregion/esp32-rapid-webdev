<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1.0">
    <meta charset="utf-8">
</head>
<body>
    <p>page loaded from <span id="wavy"></span></p>
    <div id="fetched"></div>
</body>
<script>
var word = "localhost";
var letters = [];
const wavy = document.getElementById("wavy");
for (let i = 0; i < word.length; i++) {
    let s = document.createElement("span");
    s.textContent = word[i];
    letters.push(s);
    wavy.appendChild(s)
}
function sin(n, k) {
    return Math.sin(((n % k)/k) * 3.14);
}
var n=0;
function jiggle() {
    for (let i = letters.length - 1; i >= 0; i--) {
        letters[i].style.fontSize = (sin(n + i, letters.length) * 3 + 10).toString() + 'pt';
    }
    n++;
}
setInterval(jiggle, 100);

// async function getInfo() {
//     fetch("/info")
//     .then(response => {
//         response.text().then(function(text) {
//             document.getElementById("fetched").textContent = "content fetched from ESP32:\n" + text;
//             setTimeout(getInfo, 1000);
//         })
//     })
// }

if (!!window.EventSource) {
  var source = new EventSource('/events');

  source.addEventListener('open', function(e) {
    console.log("Events Connected");
  }, false);

  source.addEventListener('error', function(e) {
    if (e.target.readyState != EventSource.OPEN) {
      console.log("Events Disconnected");
    }
  }, false);

  source.addEventListener('message', function(e) {
    console.log("message", e.data);
  }, false);

  source.addEventListener('myevent', function(e) {
    console.log("myevent", e.data);
  }, false);
}

</script>
</html>